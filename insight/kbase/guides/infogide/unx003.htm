<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<title>Info Guide UNX003</title>
<style type="text/css"><!--
	body { font-family: Arial, Helvetica, sans-serif; }

//-->
</style>
<meta name="generator" content="Microsoft FrontPage 3.0">
</head>

<body background="../../../images/mits-bg5.gif" bgcolor="#ffffff" link="#d60029"
alink="#d60029" vlink="#800080" leftmargin="0" marginwidth="0" marginheight="6">
<!-- Header - start of top table -->
<table border="0" cellpadding="0" cellspacing="0" width="98%">
<!-- The top table has the Mitsubishi logo and Home button -->
  <tr>
    <td valign="top"><img src="../../../images/m-logo-s.gif" width="193" height="70" alt="Mitsubishi Electric - Computing for a Connected World"></td>
        <td valign="bottom" align="right"><a href="../../../default.htm"><img width="41" height="32" src="../../../images/bt-home.gif" alt="Insight CD Home Page" border="0"></a></td>
  </tr>
  <tr>
    <td width="98%" colspan="2" bgcolor="#000000"><img width="1" height="1" src="../../../images/space.gif"><br>
    </td>
  </tr>
</table>
<!-- end of top table -->


<table border="0" cellpadding="0" cellspacing="0" width="98%">
  <tr>
    <td width="10" bgcolor="#000000"><img width="10" height="10"
    src="../../../images/space.gif"></td>
    <td width="120" valign="top" align="left" bgcolor="#000000"><script LANGUAGE="JavaScript">

<!--

        if (document.images) {

          var product1 = new Image()
          product1.src = "/insight/images/product1.gif"
          var product2 = new Image()
          product2.src = "/insight/images/product2.gif"

          var service1 = new Image()
          service1.src = "/insight/images/service1.gif"
          var service2 = new Image()
          service2.src = "/insight/images/service2.gif"

          var kbase1 = new Image()
          kbase1.src = "/insight/images/kbase1.gif"
          var kbase2 = new Image()
          kbase2.src = "/insight/images/kbase2.gif"       

          var upgrade1 = new Image()
          upgrade1.src = "/insight/images/upgrade1.gif"
          var upgrade2 = new Image()
          upgrade2.src = "/insight/images/upgrade2.gif"       

          var downlo1 = new Image()
          downlo1.src = "/insight/images/downlo1.gif"
          var downlo2 = new Image()
          downlo2.src = "/insight/images/downlo2.gif"       

          var inserv1 = new Image()
          inserv1.src = "/insight/images/inserv1.gif"
          var inserv2 = new Image()
          inserv2.src = "/insight/images/inserv2.gif"       

          var email1 = new Image()
          email1.src = "/insight/images/email1.gif"
          var email2 = new Image()
          email2.src = "/insight/images/email2.gif"       

          var search1 = new Image()
          search1.src = "/insight/images/search1.gif"
          var search2 = new Image()
          search2.src = "/insight/images/search2.gif"       

          var y20001 = new Image()
          y20001.src = "/insight/images/y2001.gif"
          var y20002 = new Image()
          y20002.src = "/insight/images/y2002.gif"

          var osites1 = new Image()
          osites1.src = "/insight/images/osites1.gif"
          var osites2 = new Image()
          osites2.src = "/insight/images/osites2.gif"

          var disclaim1 = new Image()
          disclaim1.src = "/insight/images/disclam1.gif"
          var disclaim2 = new Image()
          disclaim2.src = "/insight/images/disclam2.gif"

        }



        function act(imgName) {
          if (document.images)
            document[imgName].src = eval(imgName + '2.src')
        }



        function inact(imgName) {
          if (document.images)
            document[imgName].src = eval(imgName + '1.src')
        }

        // -->
</script>


    <a HREF="../../../products/main.htm" onMouseOver="act('product')" onMouseOut="inact('product')"><img width="113" height="22" src="../../../images/product1.gif" name="product" alt="Products" border="0"></a><br>

    <a HREF="../../../services/main.htm" onMouseOver="act('service')" onMouseOut="inact('service')"><img width="113" height="22" src="../../../images/service1.gif" name="service" alt="Services" border="0"></a><br>

    <a HREF="../../main.htm"><img width="113" height="22" src="../../../images/kbase2.gif" name="kbase" alt="Knowledgebase" border="0"></a><br>
       <a HREF="../../ipb/ipbmain.htm"><img width="113" height="17" src="../../../images/s_ipb.gif" alt="Bulletins (IPBs)" border="0"></a><br>
       <a HREF="../guidecon.htm"><img width="113" height="17" src="../../../images/s_guides.gif" alt="Guides" border="0"></a><br>
       <a HREF="../../faq/main.htm"><img width="113" height="17" src="../../../images/s_faq.gif" alt="FAQs" border="0"></a><br>
       <a HREF="../manuals/menu.htm"><img width="113" height="17" src="../../../images/s_manual.gif" alt="Owner's Handbooks" border="0"></a><br>
       <a HREF="../../../common/infact/menu.htm"><img width="113" height="17" src="../../../images/s_datash.gif" alt="Product Datasheets" border="0"></a><br>
       <a HREF="../../../common/misc/menu.htm"><img width="113" height="17" src="../../../images/s_misc.gif" alt="Miscellaneous Items" border="0"></a><br>

    <a HREF="../../../upgrades/main.htm" onMouseOver="act('upgrade')" onMouseOut="inact('upgrade')"><img width="113" height="22" src="../../../images/upgrade1.gif" name="upgrade" alt="Upgrades" border="0"></a><br>

    <a HREF="../../../download/main.htm" onMouseOver="act('downlo')" onMouseOut="inact('downlo')"><img width="113" height="22" src="../../../images/downlo1.gif" name="downlo" alt="Downloads" border="0"></a><br>

    <a HREF="../../../insindex.exe" onMouseOver="act('search')" onMouseOut="inact('search')"><img width="113" height="22" src="../../../images/search1.gif" name="search" alt="Search Insight" border="0"></a><br>
    <a HREF="mailto:insight@mitsubishi-computers.com" onMouseOver="act('email')" onMouseOut="inact('email')"><img width="113" height="22" src="../../../images/email1.gif" name="email" alt="E-Mail us" border="0"></a><br>
    <a HREF="http://www.mitsubishi-computers.com/support/service/" onMouseOver="act('inserv')" onMouseOut="inact('inserv')"><img width="113" height="22" src="../../../images/inserv1.gif" name="inserv" alt="Insight Service" border="0"></a><br>

    <a HREF="../../../common/year2000/year2000.htm" onMouseOver="act('y2000')" onMouseOut="inact('y2000')"><img width="113" height="21" src="../../../images/y2001.gif" name="y2000" alt="Year 2000" border="0"></a><br>
    <a HREF="../../../common/oth-site/oth-site.htm" onMouseOver="act('osites')" onMouseOut="inact('osites')"><img width="113" height="38" src="../../../images/osites1.gif" name="osites" alt="Other Mitsubishi Sites" border="0"></a><br>
    <a HREF="../../../common/disclaim.htm" onMouseOver="act('disclaim')" onMouseOut="inact('disclaim')"><img width="113" height="24" src="../../../images/disclam1.gif" name="disclaim" alt="Site Disclaimer" border="0"></a><br>
      
    <img width="113" height="120" src="../../../images/space.gif"><br>
</td>
    <td width="10" valign="top" width="10" height="10" src="/insight/images/space.gif"
    alt="10 pixel Gap" border="0"></td>

    <td valign="top"><font size="2"><br>
    </font><font face="Arial,Helvetica" size="4" color="#D60029"><strong>Info Guide UNX003:<br>
    Backup &amp; Restore on SCO UNIX 3.2v4.x &amp; OpenServer 5</strong></font><p><font
    size="2">Throughout this Info Guide the following typefaces have special meaning: </font></p>
    <table WIDTH="80%">
      <tr>
        <td><font size="2"><strong><font face="Courier New">unix</font></strong> </font></td>
        <td><font size="2">-</font></td>
        <td><font size="2">The name of a command, file, menu item, or on-screen option.</font></td>
      </tr>
      <tr>
        <td><font size="2"><font face="Courier New">Boot</font> </font></td>
        <td><font size="2">-</font></td>
        <td><font size="2">Output displayed on screen.</font></td>
      </tr>
      <tr>
        <td><u><font size="2" face="Courier New">mkdev fd</font></u></td>
        <td><font size="2">-</font></td>
        <td><font size="2">Keyboard input</font></td>
      </tr>
    </table>
    <p><strong><font size="2">Why Backup?</font></strong></p>
    <p><font size="2">No computer system can be ever described as 100% reliable. External
    influences such as mains fluctuations, unauthorised interference with the system, badly
    written code and of course, the people who use it, are all possible sources of system
    failure. Computers are now becoming more than ever &#145;Business Critical&#146;, and as
    such are instruments to the likely success or failure of the company&#146;s day to day
    operations. </font></p>
    <p><font size="2">Most systems will suffer &#145;down-time&#146; at some point in their
    operational life for any number of reasons, so it becomes essential that the impact this
    has is minimised. A sensible system recovery policy, coupled with regular backups and
    precautions will go along way toward this. </font></p>
    <p><font size="2">This may all sound familiar, but suprisingly enough, the majority of
    systems in daily use now, are still not being backed up properly, and much time is being
    wasted in re-installing software from scratch. </font></p>
    <p><strong><font size="2">About this guide</font></strong></p>
    <p><font size="2">This guide was written to address a requirement that many people do not
    have the basic knowledge to backup or recover a SCO UNIX system in the event of a major
    failure. What is covered is not an exhaustive set of methods, but those which will enable
    the user to get out of the worst scenarios fairly quickly. </font></p>
    <p><font size="2">It is possible to restore a system onto a new blank disk, without using
    the SCO master floppies, or having to start off by carrying out a basic UNIX installation.
    As a rough guide it should take about 20 minutes to partition, division and make bootable
    a new disk prior to restoring the backup tape. </font><menu>
      <p><a HREF="#UNX003_1"><font size="2">Basic Requirements</font></a><ul>
        <li><font size="2">Creating the Root and Boot floppies </font></li>
        <li><font size="2">Create the tape backups </font></li>
        <li><font size="2">Determining the disk division table layout </font></li>
      </ul>
      <p><font size="2"><a HREF="#UNX003_2">Rebuilding the System</a> </font><ul>
        <li><font size="2">Rebuilding the root operating system disk </font></li>
        <li><font size="2">Rebuilding on original disk </font></li>
        <li><font size="2">Restoring other filesystems </font></li>
        <li><font size="2">Rebuilding on new root disk </font></li>
        <li><font size="2">Creating lost+found </font></li>
        <li><font size="2">Rebuilding non-root disks </font></li>
      </ul>
    </menu>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><font size="2">(5th September 1995) <br>
    <br>
    <a HREF="#top"><img SRC="../../../graphics/redarr01.gif" BORDER="0" ALIGN="LEFT" ALT="Back to Top"
    width="14" height="10"></a> <a HREF="#top"><img SRC="../../../graphics/redarr01.gif" BORDER="0"
    ALIGN="RIGHT" ALT="Back to Top" width="14" height="10"></a> </font></p>
    <hr>
    <p><a name="unx003_1"></a><font size="3"><strong>Basic Requirements</strong></font></p>
    <p><font size="2">With any SCO UNIX system, the absolute minimum requirement for any
    backup should be regarded as: </font><ol>
      <li TYPE="a"><font size="2">Root and Boot floppies (created using <strong><font
        face="Courier New">mkdev fd</font></strong>)</font></li>
      <li TYPE="a"><font size="2">Root filesystem backup on cartridge tape, format. (<u>not</u> <strong><font
        face="Courier New">tar</font></strong> as this does not backup empty directories, empty
        files, or device nodes) </font></li>
      <li TYPE="a"><font size="2">Separate backups of other filesystems (usually containing
        customers data) </font></li>
      <li TYPE="a"><font size="2">Printouts of hard disk(s) division table (output from <strong><font
        face="Courier New">divvy</font></strong>) <br>
        <br>
        Additionally, for SCO OpenServer 5:<br>
        </font></li>
      <li TYPE="a"><font size="2">Backup of /boot filesystem (/stand) </font></li>
    </ol>
    <p><font size="2">These must be created as soon as the system is installed, and maintained
    up to date to reflect the changes in the system as time goes on. </font></p>
    <p><strong><font size="2">Creating the Root and Boot floppies</font></strong></p>
    <p><font size="2">Make sure that you have to hand, 2 DSHD 1.44Mb floppy disks. These need
    not be formatted beforehand, as the system will ask you if you want to format during
    creation of the disk set. </font></p>
    <p><font size="2">As root, type in: </font><menu>
      <p><font size="2"><u><font face="Courier New"># mkdev fd</font></u> </font></p>
    </menu>
    <p><font size="2">and the floppy creation will start. Use the menu options to create a
    &#147;Boot&#148; floppy and a &#147;Root filesystem&#148; floppy. Note that the installed
    kernel on floppy will take on the characteristics of the main kernel, so all the currently
    configured devices will be recognised when the system is booted from the floppies. In
    these later versions of UNIX, most of the utilities you will need are automatically copied
    over to the root filesystem disk. In earlier versions including Xenix, these had to be
    added manually. </font></p>
    <p><font size="2">Ensure that the disks are <strong>not</strong> write protected. </font></p>
    <p><font size="2">Your emergency floppies are now ready. Label them as &#145;boot
    disk&#146; and &#145;root filesystem disk&#146; as appropriate: If the system
    configuration changes significantly, it may pay to re-create them from time to time. </font></p>
    <p><strong><font size="2">Create the tape backups</font></strong></p>
    <p><font size="2">This can also be done from <strong><font face="Courier New">sysadmsh</font></strong>
    (up to 4.2) or <strong><font face="Courier New">scoadmin</font></strong> As root, this can
    be done from single or multiuser mode. It is preferable to be in single user mode, as this
    also ensures that only root can be logged in during the backup process. Identify first
    which filesystems are currently mounted. Ensure that only root is mounted. </font></p>
    <p><font size="2">Type in: </font><menu>
      <p><font size="2"><u><font face="Courier New"># mount</font></u> </font></p>
    </menu>
    <p><font size="2">This should show: </font></p>
    <p><em><font size="2">On SCO UNIX 3.2v4.x </font></em><menu>
      <p><font size="2"><font face="Courier New">/ on /dev/root read/write on</font> (some date)
      </font></p>
    </menu>
    <p><em><font size="2">On SCO OpenServer 5.0 </font></em><menu>
      <p><font size="2"><font face="Courier New">/ on /dev/root read/write on</font> (some date)<br>
      <font face="Courier New">/stand on /dev/boot read only on</font> (some date) </font></p>
    </menu>
    <p><font size="2">If the output shows additional filesystems that are mounted, type: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /<br>
      # umountall</font></u></p>
    </menu>
    <p><font size="2">Ensure the tape is in the appropriate drive. Make sure you are in the
    root directory: </font><menu>
      <p><font size="2"><u><font face="Courier New"># pwd /</font></u> </font></p>
    </menu>
    <p><font size="2">Enter the cpio backup command as follows: </font><menu>
      <p><font size="2"><u><font face="Courier New"># find . -mount -depth -print|cpio -ov
      &gt;/dev/rStp0</font></u> </font></p>
    </menu>
    <p><font size="2">Substitute your own tape device name for &#145;rStp0&#146; </font></p>
    <p><font size="2">The <em>-mount</em> option to <strong><font face="Courier New">cpio</font></strong>
    ensures that only the current filesystem contents are archived. This is particularly
    important for OpenServer 5, where the /stand filesystem has to be archived separately. </font></p>
    <p><font size="2">Label this tape as &#145;root filesystem backup&#146;. </font></p>
    <p><font size="2"><em>Additionally, for SCO OpenServer 5 only</em> <br>
    Insert new tape: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /stand # find . -print -depth|cpio -ov
      &gt;/dev/rStp0</font></u></p>
    </menu>
    <p><font size="2">Substitute your own tape device name for &#145;rStp0&#146; </font></p>
    <p><font size="2">Label this tape as &#145;boot filesystem backup&#146;. </font></p>
    <p><font size="2">Mount up any additional filesystems that you might have, and back these
    up on separate tapes as required. In the example, there is a /u filesystem: </font><menu>
      <p><font size="2" face="Courier New"><u># mountall -f<br>
      # mount<br>
      </u>/ on /dev/root read/write on (some date)<br>
      /stand on /dev/boot read only on (some date) <strong>(OpenServer 5 only)</strong><br>
      /u on /dev/u read/write on (some date)<br>
      <u># cd /u<br>
      # find . -print -depth|cpio -ov &gt;/dev/rStp0</u> </font></p>
    </menu>
    <p><font size="2">Substitute your own tape device name for &#145;rStp0&#146; </font></p>
    <p><font size="2">Label this up as &#145;/u filesystem backup&#146; </font></p>
    <p><font size="2">Store these in a safe place with the root/boot floppies. </font></p>
    <p><strong><font size="2">Determining the disk division table layout </font></strong></p>
    <p><font size="2">This step is absolutely necessary in order to keep an accurate record of
    the way the disk is partitioned and split up into filesystems. When the original software
    is restored, the filesystems will have to be set up exactly as they were previously. This
    information is not stored on the root and boot floppies, and therefore has to be manually
    configured when the system is rebuilt. </font></p>
    <p><font size="2">The command <strong><font face="Courier New">divvy</font></strong> will
    report the appropriate information as follows for UNIX 3.2v4.2. To produce a file for
    printing with the information below, use the command <u><font face="Courier New">divvy
    &gt; filename</font></u> and then enter <u><font face="Courier New">q&lt;return&gt;</font></u>
    followed by <u><font face="Courier New">e&lt;return&gt;</font></u> (divvy command quit and
    exit options): </font></p>
    <p><font size="2" face="Courier New"><u># divvy /dev/hd0a</u> </font></p>
    <table cellspacing="0" cellpadding="3">
      <tr>
        <td><font size="2" face="Courier New">Name </font></td>
        <td><font size="2" face="Courier New">Type </font></td>
        <td><font size="2" face="Courier New">New FS </font></td>
        <td><font size="2" face="Courier New"># </font></td>
        <td><font size="2" face="Courier New">First Block </font></td>
        <td><font size="2" face="Courier New">Last Block</font></td>
      </tr>
      <tr>
        <td><font size="2" face="Courier New">root </font></td>
        <td><font size="2" face="Courier New">EAFS </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">0 </font></td>
        <td><font size="2" face="Courier New">0 </font></td>
        <td><font size="2" face="Courier New">209715</font></td>
      </tr>
      <tr>
        <td><font size="2" face="Courier New">swap </font></td>
        <td><font size="2" face="Courier New">NON FS </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">1 </font></td>
        <td><font size="2" face="Courier New">209716 </font></td>
        <td><font size="2" face="Courier New">335544</font></td>
      </tr>
      <tr>
        <td><font size="2" face="Courier New">u </font></td>
        <td><font size="2" face="Courier New">EAFS </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">2 </font></td>
        <td><font size="2" face="Courier New">335545 </font></td>
        <td><font size="2" face="Courier New">1056757</font></td>
      </tr>
      <tr>
        <td></td>
        <td><font size="2" face="Courier New">NOT USED </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">3 </font></td>
        <td><font size="2" face="Courier New">- </font></td>
        <td><font size="2" face="Courier New">-</font></td>
      </tr>
      <tr>
        <td></td>
        <td><font size="2" face="Courier New">NOT USED </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">4 </font></td>
        <td><font size="2" face="Courier New">- </font></td>
        <td><font size="2" face="Courier New">-</font></td>
      </tr>
      <tr>
        <td></td>
        <td><font size="2" face="Courier New">NOT USED </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">5 </font></td>
        <td><font size="2" face="Courier New">- </font></td>
        <td><font size="2" face="Courier New">-</font></td>
      </tr>
      <tr>
        <td><font size="2" face="Courier New">recover </font></td>
        <td><font size="2" face="Courier New">NON FS </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">6 </font></td>
        <td><font size="2" face="Courier New">1056758 </font></td>
        <td><font size="2" face="Courier New">1056767</font></td>
      </tr>
      <tr>
        <td><font size="2" face="Courier New">hd0a </font></td>
        <td><font size="2" face="Courier New">WHOLE DISK </font></td>
        <td><font size="2" face="Courier New">no </font></td>
        <td><font size="2" face="Courier New">7 </font></td>
        <td><font size="2" face="Courier New">0 </font></td>
        <td><font size="2" face="Courier New">1057775</font></td>
      </tr>
      <tr>
        <td COLSPAN="6"><font size="2" face="Courier New">1056768 1K blocks for divisions,1008 1K
        blocks reserved for the system.</font></td>
      </tr>
    </table>
    <p><font size="2">The previous example corresponds to the root drive. (<strong><font
    face="Courier New">divvy</font></strong> with no arguments defaults to the root drive).
    This drive is 1Gb in total size, with a 200Mb root filesystem, a 32Mb swap area and the
    remainder of the drive is divided up between a separate filesystem called <strong><font
    face="Courier New">u</font></strong>, and the recovery area. </font></p>
    <p><font size="2">In SCO OpenServer 5.0, there will be an additional entry called <strong><font
    face="Courier New">boot</font></strong>. This will appear at the top of the table followed
    by swap and root. Any subsequent filesystems will appear after that. </font></p>
    <p><font size="2">The table entry <strong><font face="Courier New">hd0a</font></strong>
    refers to drive 0 active partition (root disk). If there are other disks on the system,
    use divvy specifying the appropriate drive number. i.e.: </font><menu>
      <p><u><font size="2" face="Courier New"># divvy /dev/hd1a</font></u></p>
    </menu>
    <p><font size="2">For the second drive, active partition. </font></p>
    <p><font size="2">Print these out and keep a copy of them with the backup media. </font></p>
    <p><font size="2"><u>Do not</u> under any circumstances alter the current settings or
    names while you are in <strong><font face="Courier New">divvy</font></strong>. This will
    seriously compromise the integrity of the data already on the target drive. If you intend
    to alter the drive partitioning information to add an another filesystem or expand an
    existing filesystem for example, then you must backup the whole target disk first. If you
    are in any doubt, call UNIX Support first. </font></p>
    <p><font size="2">Use the options <font face="Courier New">&#145;q to quit&#146;</font>
    and <font face="Courier New">&#145;e to Exit without installing a division table&#146;</font>
    to quit the program. This will exit the program <strong>without</strong> saving any
    changes whether accidental or otherwise. <br>
    <br>
    <a HREF="#top"><img SRC="../../../graphics/redarr01.gif" BORDER="0" ALIGN="LEFT" ALT="Back to Top"
    width="14" height="10"></a> <a HREF="#top"><img SRC="../../../graphics/redarr01.gif" BORDER="0"
    ALIGN="RIGHT" ALT="Back to Top" width="14" height="10"></a> </font></p>
    <hr>
    <p><a name="unx003_2"></a><font size="3"><strong>Rebuilding the System</strong></font></p>
    <p><strong><font size="2">Rebuilding the root operating system disk </font></strong></p>
    <p><font size="2">In general, the drive that tends to suffer after a crash, or just
    through general wear and tear is the root drive. This contains the main bulk of the
    operating system, and any corruption occurring in this area can be regarded as generally
    critical. If the drive has failed through excessive bad block reporting, or for any other
    reason, then it should be replaced with a new one of the same type if possible. </font></p>
    <p><font size="2">If the problem can be traced to other sources such as accidental power
    down or deletion of system data by the operator, then the disk obviously need not be
    changed. In this case, the original partition table will most likely still be intact.
    Typically, the system will be unbootable and assuming that all other possible solutions
    have been exhausted, a re-build from the backups will be necessary. </font></p>
    <p><font size="2"><strong>Rebuilding on original disk</strong><br>
    First, power the system down and insert the floppy labelled &#145;Boot disk&#146;. Power
    the system on and allow the machine to boot from the floppy. When this prompt appears: </font><menu>
      <p><font size="2"><font face="Courier New">boot:</font> </font></p>
    </menu>
    <p><font size="2">press return. After the initial system load, you will be prompted to
    insert the filesystem disk. Remove the boot floppy and insert the &#145;root
    filesystem&#146; disk. </font></p>
    <p><font size="2">The system will complete its initialisation and leave you at the
    &#145;#&#146; prompt. </font></p>
    <p><font size="2">Do <u><strong>not</strong></u> remove the floppy at any time from now on
    until you re-boot the system. This is because the system is running from the floppy, and
    requires read/write access to it at all times. </font></p>
    <p><font size="2">The hard disk root file system will now need to be cleaned. To do this,
    type: </font><menu>
      <p><font size="2" face="Courier New"><u># fsck -y /dev/hd0root</u></font></p>
    </menu>
    <p><font size="2">and the system should then start the filesystem check. If it responds
    instead with: </font><menu>
      <p><font size="2" face="Courier New">/dev/hd0root:cannot stat</font></p>
    </menu>
    <p><font size="2">Or something similar, then the problem may be more severe. In this case,
    the root filesystem will need to be re-created from scratch, as it probably contains one
    or more incorrect files. Do this as described in the section &#145;<em>Rebuilding on new
    disk</em>&#146;. </font></p>
    <p><font size="2">Additionally, for <strong>Openserver 5.0 only</strong>: </font><menu>
      <p><u><font size="2" face="Courier New"># fsck -y /dev/boot</font></u></p>
    </menu>
    <p><font size="2">Once fsck has completed without errors, mount the root filesystem as
    follows: </font><menu>
      <p><u><font size="2" face="Courier New"># mount /dev/hd0root /mnt</font></u></p>
    </menu>
    <p><font size="2">Change directory to /mnt </font><menu>
      <p><u><font size="2" face="Courier New"># cd /mnt</font></u></p>
    </menu>
    <p><font size="2">Make sure that you are in the /mnt directory by using <u><font
    face="Courier New">pwd</font></u> </font></p>
    <p><font size="2">Insert your root filesystem backup tape into the tape drive. Use the
    following command to restore the data. Substitute your own tape device name for
    &#145;rStp0&#146;. (Note that rStp0 will always be the first SCSI tape drive defined in <strong><font
    face="Courier New">/etc/conf/cf.d/mscsi</font></strong>): </font><menu>
      <p><u><font size="2" face="Courier New"># cpio -ivdum &lt;/dev/rStp0</font></u></p>
    </menu>
    <p><font size="2">This will restore the root filesystem data. </font></p>
    <p><font size="2">For <strong><em>SCO Openserver 5.0 only</em></strong>, unmount the root
    filesystem and mount the boot filesystem: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /<br>
      # umount /mnt<br>
      # mount /dev/boot /mnt</font></u></p>
    </menu>
    <p><font size="2">Insert the &#145;boot filesystem backup&#146; tape. Continue as before: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /mnt<br>
      # cpio -ivdum &lt;/dev/rStp0</font></u></p>
    </menu>
    <p><font size="2"><em><strong>All Versions</strong></em><br>
    Once this has completed check that the root filesystem (and for OpenServer 5, the boot
    filesystem) are clean by running <strong><font face="Courier New">fsck</font></strong>
    again after unmounting them first. Use the following commands: </font><menu>
      <p><font size="2" face="Courier New"><u># cd /<br>
      # umountall<br>
      # fsck /dev/hd0root<br>
      # fsck /dev/boot</u><em><strong> (SCO Openserver 5.0 only)</strong></em><u><br>
      # haltsys</u></font></p>
    </menu>
    <p><font size="2">And wait for the system to reply with: </font></p>
    <pre><font size="2" face="Courier New">	***     Safe to power off       ***
		         or
	***  Press any key to reboot    ***</font></pre>
    <p><font size="2">Power the machine off, remove the floppy disk, and try to reboot from
    the hard disk. If the system still fails to boot, attempt to re-write the boot tracks as
    described in <em>rebuilding on new disk</em>. Failing that, contact UNIX Support. </font></p>
    <p><font size="2"><em><strong>Restoring other filesystems</strong></em><br>
    If there were additional filesystems on the root filesystem disk, try to ascertain their
    condition. If they were auto mount filesystems, the system will try to clean them
    automatically when going multiuser. If this was successful, examine the contents to check
    their integrity. If the data looks suspect or behaves incorrectly, you will have to
    restore this from the backup you made of this too. </font></p>
    <p><font size="2">Note that it is preferable to be in single user mode to do the restore.
    If the system was allowed to go multiuser, use the following command at the console
    (tty01): </font><menu>
      <p><u><font size="2" face="Courier New"># init 1</font></u></p>
    </menu>
    <p><font size="2">Use <strong><font face="Courier New">mount</font></strong> to check if
    the filesystem is already mounted: </font><menu>
      <p><font size="2" face="Courier New"><u># mount</u><br>
      / on /dev/root read/write on (some date)<br>
      /stand on /dev/boot read only on (some date) <em><strong>(OpenServer 5 only)</strong></em><br>
      <strong>/u on /dev/u read/write on (some date)</strong></font></p>
    </menu>
    <p><font size="2">/u is only used as an example in this document. In practice, there may
    be more filesystems of widely differing names on other systems. If the filesystem(s)
    is/are not mounted, mount it/them now: </font><menu>
      <p><u><font size="2" face="Courier New"># mountall -f</font></u></p>
    </menu>
    <p><font size="2">Change directory to the relevant mount point. In this case: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /u</font></u></p>
    </menu>
    <p><font size="2">Insert the appropriate filesystem backup tape. Start the restore: </font><menu>
      <p><u><font size="2" face="Courier New"># cpio -ivdum &lt;/dev/rStp0</font></u></p>
    </menu>
    <p><font size="2">Again, &#145;rStp0&#146; is only an example. Use your own tape device
    name if different. </font></p>
    <p><font size="2">Once the restore has completed, check the integrity of the data on that
    filesystem using <strong><font face="Courier New">fsck</font></strong>. </font></p>
    <p><font size="2">Use the same procedure as detailed previously, if the additional
    filesystems were residing on separate disks. </font></p>
    <p><font size="2"><em><strong>Rebuilding on new root disk</strong></em> <br>
    This section also applies to an existing disk that has been low level formatted or has
    lost its boot track and/or its fdisk table. </font></p>
    <p><font size="2">The majority of the procedure is the same as if you were re-installing
    an original drive, with the notable exception that the drive has to be manually
    partitioned and made bootable before the restore can take place. Proceed as follows. </font></p>
    <p><font size="2">For a new drive, ensure that the drive is installed correctly. In the
    case of SCSI drives, make sure that the ID matches that of the original drive, and that it
    is terminated appropriately for it&#146;s position on the SCSI bus. </font></p>
    <p><font size="2">Boot off of the root/boot floppy set as detailed at the beginning of the
    previous section. </font></p>
    <p><font size="2">Use the <strong><font face="Courier New">fdisk</font></strong> command
    to initialise the UNIX area as follows: </font><menu>
      <p><u><font size="2" face="Courier New"># fdisk</font></u></p>
    </menu>
    <p><font size="2">If the disk needs to contain a DOS partition, make sure that this was
    installed prior to re-booting in UNIX </font></p>
    <p><font size="2">Follow the on-screen instructions to either use the whole disk for UNIX
    or use rest of disk for UNIX if DOS partition is installed. Make the UNIX partition
    active. </font></p>
    <p><font size="2">Next, the disk partition containing SCO UNIX or OpenServer 5 needs to be
    divided into filesystems. This is where you will need the details of the original division
    table installation. </font></p>
    <p><font size="2">Use the <strong><font face="Courier New">divvy</font></strong> command
    as follows: </font><menu>
      <p><u><font size="2" face="Courier New"># divvy -i /dev/hd0a</font></u></p>
    </menu>
    <p><font size="2">The &#145;-i&#146; option to <strong><font face="Courier New">divvy</font></strong>
    specifies an installation. Answer the questions about root and swap sizes with any legal
    number. Then answer yes to the question about making manual changes. Edit the start and
    end blocks of each filesystem according to the original values using the <strong><font
    face="Courier New">s</font></strong> and <strong><font face="Courier New">e</font></strong>
    menu options. Ensure that none of the start and end blocks overlap on each filesystem, and
    that the names of filesystems correspond with the original, using the <strong><font
    face="Courier New">n</font></strong> (name) menu option to set the names as required. </font></p>
    <p><font size="2">When each filesystem has been named, and the correct start/end blocks
    have been selected, use the <strong><font face="Courier New">c</font></strong> (create)
    option to initialise the filesystems. Do not, however do this on the &#145;swap&#146;
    area, as this must remain raw. Each filesystem will now have a type assigned to it. Ensure
    this ties up with the original. The default for UNIX 3.2v4.2 is <strong>EAFS</strong> and
    in OpenServer 5 the default is <strong>HTFS</strong>, apart from /boot which has to be
    EAFS to be bootable. </font></p>
    <p><font size="2">Select the <strong><font face="Courier New">q</font></strong> (quit)
    option followed by the <strong><font face="Courier New">i</font></strong> (inatall) option
    from the final menu and the machine should report: </font><menu>
      <p><font size="2" face="Courier New">making filesystems</font></p>
    </menu>
    <p><font size="2">Once this has completed, create a lost+found directory in the new root
    directory. In order to do this, you need to mount the hard disk first: </font><menu>
      <p><u><font size="2" face="Courier New"># cd /<br>
      # mount /dev/hd0root /mnt</font></u></p>
    </menu>
    <p><font size="2"><em><strong>Creating lost+found </strong></em><br>
    Create the lost+found directory, and the &#145;slots&#146; in it as follows: </font><menu>
      <p><font size="2"><font face="Courier New"><u># cd /mnt<br>
      # mkdir lost+found<br>
      # cd lost+found<br>
      # for a in 1 2 3 4 5 6 7 8 9 0<br>
      &gt; do<br>
      &gt; for b in 1 2 3 4 5 6 7 8 9 0<br>
      &gt; do<br>
      &gt; &gt;${a}${b}<br>
      &gt; rm ??<br>
      &gt; done<br>
      &gt; done</u><br>
      #</font> </font></p>
    </menu>
    <p><font size="2">Next, re-write the boot tracks as follows: </font><menu>
      <p><u><font size="2" face="Courier New"># dd if=/etc/hdboot0 of=/dev/hd0a<br>
      # dd if=/etc/hdboot1 of=/dev/hd0a bs=1k seek=1<br>
      # dparam -w </font></u></p>
    </menu>
    <p><font size="2">At this point, check each filesystem with fsck to ensure integrity -
    this also acts as a check to ensure that the boot track data has not been written over the
    start of the disk by mistake, which can easily happen if hd00 is specified instead of hd0a
    in the dd commands above. If the mistake is made the fdisk and divvy tables will be lost
    so fsck will give an error. </font><menu>
      <p><font size="2"><u><font face="Courier New"># fsck /dev/hd0root<br>
      # fsck /dev/boot</font></u> <em><strong>(OpenServer 5 only)</strong></em></font></p>
    </menu>
    <p><font size="2">The drive is now ready to have the data restored. You can shut the
    system down at this point, (<strong><font face="Courier New">haltsys</font></strong>) and
    proceed as detailed in the section &#145;Rebuilding on original disk&#146;. </font></p>
    <p><font size="2"><em><strong>Rebuilding non-root disks</strong></em> <br>
    For any additional disks that contain good filesystems then the procedure discussed under
    the section &#145;Rebuilding on original disk&#146; can be followed. </font></p>
    <p><font size="2">For additional disks that are new, re-formatted, or otherwise wiped, it
    is best to use the mkdev hd command to create them again. This will run fdisk followed by
    divvy. </font></p>
    <p><font size="2">The lost+found directory will need creating with empty slots as per the
    &#145;Creating lost+found&#146; sub-section, or an easier method is to use the <u><font
    face="Courier New">mkdev fs</font></u> command. This will ask for the device name, which
    for a filesystem called user2 would be <u><font face="Courier New">/dev/user2</font></u>.
    Answer the questions about automatically mounting and whether users can mount the
    filesystem. The <u><font face="Courier New">mkdev fs</font></u> script will then say <strong><font
    face="Courier New">Reserving slots in lost+found directory</font></strong>. Once complete
    you will need to edit the entry that it has added to the file <font face="Courier New">/etc/default/filesys</font>
    as one will already exist from the original installation. Below is an example of this
    file: </font><menu>
      <p><font size="2">bdev=/dev/users cdev=/dev/rusers \ </font><menu>
        <p><font size="2">desc=&quot;users:users:yes:yes:1&quot; \<br>
        mountdir=/users rcmount=yes mount=no </font></p>
      </menu>
      <p><font size="2">#<br>
      bdev=/dev/user2 cdev=/dev/ruser2 \ </font><menu>
        <p><font size="2">desc=&quot;user2:user2:yes:yes:1&quot; \<br>
        mountdir=/user2 rcmount=yes mount=no </font></p>
      </menu>
      <p><font size="2">#<br>
      <strong>bdev=/dev/user2 cdev=/dev/ruser2 \<br>
      </strong></font><menu>
        <p><font size="2"><strong>desc=&quot;user2:user2:yes:yes:1&quot; \<br>
        mountdir=/user2 rcmount=yes mount=no</strong> </font></p>
      </menu>
    </menu>
    <p><font size="2">Delete the second entry above. Note that sometimes such entries appear
    all on one physical line instead of these logical lines where the backslash is treated as
    a &#147;continuation&#148; mark.</font></p>
    <p><font size="2"><a HREF="#top"><img SRC="../../../graphics/redarr01.gif" BORDER="0" ALIGN="LEFT"
    ALT="Back to Top" width="14" height="10"></a> <a HREF="#top"><img
    SRC="../../../graphics/redarr01.gif" BORDER="0" ALIGN="RIGHT" ALT="Back to Top" width="14"
    height="10"></a> </font></p>
    <hr>
    
    <p>&nbsp;</p>
    <p align="center"><img width="486" height="25" src="../../../images/connectd.gif"
    alt="Computing for a Connected World"> </td>
  </tr>
</table>
</body>
</html>
